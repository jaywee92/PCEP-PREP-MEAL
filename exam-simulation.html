<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCEP Exam Simulation</title>
    <style>
        :root {
            --primary-light: #0a84ff;
            --module1: #6366f1;
            --module2: #ec4899;
            --module3: #f59e0b;
            --module4: #10b981;
            --dark-bg: #0f172a;
            --dark-surface: #1e293b;
            --dark-surface-light: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border-color: #475569;
            --success: #22c55e;
            --error: #ef4444;
            --warning: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Utility Classes */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .gradient-text {
            background: linear-gradient(135deg, var(--module1), var(--module2), var(--module3), var(--module4));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--module1), var(--module2));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(99, 102, 241, 0.3);
        }

        .btn-secondary {
            background: var(--dark-surface-light);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            border-color: var(--primary-light);
            background: var(--dark-surface);
        }

        .btn-lg {
            padding: 1.25rem 2.5rem;
            font-size: 1.125rem;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Setup Screen */
        .setup-screen {
            max-width: 800px;
            margin: 0 auto;
        }

        .setup-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .setup-header h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, var(--module1), var(--module2), var(--module3), var(--module4));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .setup-header p {
            color: var(--text-secondary);
            font-size: 1.125rem;
        }

        .setup-section {
            background: var(--dark-surface);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .setup-section:hover {
            border-color: var(--primary-light);
            background: var(--dark-surface-light);
        }

        .setup-section h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .setup-section h2 span {
            background: linear-gradient(135deg, var(--module1), var(--module2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            background: var(--dark-bg);
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            border-color: var(--primary-light);
            background: var(--dark-surface);
        }

        .checkbox-item input[type="checkbox"] {
            width: 1.25rem;
            height: 1.25rem;
            cursor: pointer;
            margin-right: 0.75rem;
            accent-color: var(--primary-light);
        }

        .checkbox-item label {
            cursor: pointer;
            flex: 1;
            font-weight: 500;
        }

        .min-modules-warning {
            color: var(--warning);
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
        }

        .min-modules-warning.show {
            display: block;
        }

        .slider-container {
            margin-bottom: 1.5rem;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .slider-value {
            background: linear-gradient(135deg, var(--module1), var(--module2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
            font-size: 1.125rem;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: var(--dark-bg);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--module1), var(--module2));
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--module1), var(--module2));
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
        }

        .timer-checkbox {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .timer-checkbox input {
            width: 1.5rem;
            height: 1.5rem;
            cursor: pointer;
            accent-color: var(--primary-light);
            margin-right: 1rem;
        }

        .timer-checkbox label {
            cursor: pointer;
            font-weight: 500;
        }

        .timer-info {
            background: var(--dark-bg);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
            border-left: 4px solid var(--module3);
            color: var(--text-secondary);
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .radio-item {
            display: flex;
            align-items: flex-start;
            cursor: pointer;
        }

        .radio-item input[type="radio"] {
            width: 1.5rem;
            height: 1.5rem;
            cursor: pointer;
            accent-color: var(--primary-light);
            margin-right: 1rem;
            margin-top: 0.25rem;
            flex-shrink: 0;
        }

        .radio-item-content {
            flex: 1;
        }

        .radio-item-content label {
            display: block;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 0.25rem;
        }

        .radio-item-content p {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .setup-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        .setup-actions .btn-primary {
            flex: 1;
        }

        /* Exam Screen */
        .exam-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .exam-progress {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .exam-progress .progress-value {
            background: linear-gradient(135deg, var(--module1), var(--module2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .exam-timer {
            font-size: 1.5rem;
            font-weight: 700;
            min-width: 120px;
            text-align: center;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            background: var(--dark-surface);
            border: 2px solid var(--border-color);
        }

        .exam-timer.warning {
            border-color: var(--warning);
            background: rgba(245, 158, 11, 0.1);
        }

        .exam-timer.critical {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.1);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .exam-back {
            padding: 0.75rem 1.5rem;
        }

        .exam-content {
            display: grid;
            grid-template-columns: 1fr 250px;
            gap: 2rem;
        }

        @media (max-width: 1024px) {
            .exam-content {
                grid-template-columns: 1fr;
            }
        }

        .question-container {
            background: var(--dark-surface);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
        }

        .question-number {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .question-text {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .code-block {
            background: var(--dark-bg);
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #e2e8f0;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .option {
            padding: 1.25rem;
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--dark-bg);
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .option:hover {
            border-color: var(--primary-light);
            background: var(--dark-surface-light);
            transform: translateX(4px);
        }

        .option input[type="radio"] {
            width: 1.5rem;
            height: 1.5rem;
            cursor: pointer;
            accent-color: var(--primary-light);
            margin-top: 0.25rem;
            flex-shrink: 0;
        }

        .option-label {
            flex: 1;
            cursor: pointer;
        }

        .option.correct {
            background: rgba(34, 197, 94, 0.1);
            border-color: var(--success);
        }

        .option.incorrect {
            background: rgba(239, 68, 68, 0.1);
            border-color: var(--error);
        }

        .option.selected.correct::after,
        .option.selected.incorrect::after {
            content: '';
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .option.selected.correct::after {
            content: '‚úì';
            color: var(--success);
        }

        .option.selected.incorrect::after {
            content: '‚úó';
            color: var(--error);
        }

        .feedback-container {
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: 0.5rem;
            display: none;
        }

        .feedback-container.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .feedback-correct {
            background: rgba(34, 197, 94, 0.1);
            border-left: 4px solid var(--success);
            color: var(--success);
        }

        .feedback-incorrect {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid var(--error);
            color: var(--error);
        }

        .feedback-title {
            font-weight: 700;
            margin-bottom: 0.5rem;
            font-size: 1.125rem;
        }

        .hint-section,
        .explanation-section {
            margin-top: 1rem;
            color: var(--text-secondary);
        }

        .hint-section strong,
        .explanation-section strong {
            color: var(--text-primary);
            display: block;
            margin-bottom: 0.5rem;
        }

        .question-controls {
            display: flex;
            justify-content: space-between;
            gap: 1rem;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .question-controls .btn {
            flex: 1;
            min-width: 120px;
        }

        .question-navigator {
            background: var(--dark-surface);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 2rem;
        }

        .navigator-title {
            font-weight: 600;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        .navigator-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
        }

        @media (max-width: 1024px) {
            .navigator-grid {
                grid-template-columns: repeat(10, 1fr);
            }
        }

        .navigator-item {
            width: 100%;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--border-color);
            border-radius: 0.375rem;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--dark-bg);
            font-weight: 600;
            font-size: 0.75rem;
        }

        .navigator-item:hover {
            border-color: var(--primary-light);
        }

        .navigator-item.answered {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-light);
        }

        .navigator-item.current {
            background: linear-gradient(135deg, var(--module1), var(--module2));
            color: white;
            border-color: var(--module1);
            box-shadow: 0 0 12px rgba(99, 102, 241, 0.5);
        }

        .navigator-item.skipped {
            background: var(--dark-surface);
            border-color: var(--border-color);
        }

        .navigator-legend {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }

        .legend-dot.answered {
            background: var(--primary-light);
        }

        .legend-dot.unanswered {
            background: var(--dark-bg);
            border: 1px solid var(--border-color);
        }

        .legend-dot.current {
            background: linear-gradient(135deg, var(--module1), var(--module2));
            box-shadow: 0 0 6px rgba(99, 102, 241, 0.5);
        }

        /* Results Screen */
        .results-screen {
            max-width: 900px;
            margin: 0 auto;
        }

        .results-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .score-circle {
            width: 200px;
            height: 200px;
            margin: 2rem auto;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 4px solid;
            font-size: 3rem;
            font-weight: 700;
        }

        .score-circle.pass {
            border-color: var(--success);
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }

        .score-circle.fail {
            border-color: var(--error);
            background: rgba(239, 68, 68, 0.1);
            color: var(--error);
        }

        .score-percentage {
            font-size: 2rem;
        }

        .score-status {
            font-size: 1.5rem;
            margin-top: 2rem;
            text-align: center;
        }

        .score-status.pass {
            color: var(--success);
        }

        .score-status.fail {
            color: var(--error);
        }

        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 3rem 0;
        }

        .stat-card {
            background: var(--dark-surface);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--module1), var(--module2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .modules-breakdown {
            background: var(--dark-surface);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            margin: 2rem 0;
        }

        .modules-breakdown h3 {
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
        }

        .module-score {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--dark-bg);
            border-radius: 0.5rem;
            border-left: 4px solid;
        }

        .module-score.module1 { border-left-color: var(--module1); }
        .module-score.module2 { border-left-color: var(--module2); }
        .module-score.module3 { border-left-color: var(--module3); }
        .module-score.module4 { border-left-color: var(--module4); }

        .module-score-name {
            flex: 1;
            font-weight: 600;
        }

        .module-score-bar {
            flex: 2;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 1rem;
        }

        .module-score-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .module-score.module1 .module-score-fill { background: var(--module1); }
        .module-score.module2 .module-score-fill { background: var(--module2); }
        .module-score.module3 .module-score-fill { background: var(--module3); }
        .module-score.module4 .module-score-fill { background: var(--module4); }

        .module-score-value {
            min-width: 100px;
            text-align: right;
            font-weight: 700;
            color: var(--text-secondary);
        }

        .detailed-review {
            margin: 2rem 0;
        }

        .detailed-review h3 {
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
        }

        .review-item {
            background: var(--dark-surface);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid;
        }

        .review-item.correct {
            border-left-color: var(--success);
        }

        .review-item.incorrect {
            border-left-color: var(--error);
        }

        .review-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .review-item-number {
            font-weight: 700;
            color: var(--text-secondary);
        }

        .review-item-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .review-item-status.correct {
            color: var(--success);
        }

        .review-item-status.incorrect {
            color: var(--error);
        }

        .review-item-question {
            font-weight: 600;
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .review-item-code {
            background: var(--dark-bg);
            border: 2px solid var(--border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            overflow-x: auto;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.85rem;
            line-height: 1.6;
        }

        .review-answers {
            background: var(--dark-bg);
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .answer-result {
            padding: 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .answer-result.your-answer {
            background: rgba(99, 102, 241, 0.2);
            border-left: 3px solid var(--primary-light);
        }

        .answer-result.correct-answer {
            background: rgba(34, 197, 94, 0.2);
            border-left: 3px solid var(--success);
        }

        .answer-result label {
            display: block;
            color: var(--text-secondary);
            font-size: 0.75rem;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
        }

        .answer-result-text {
            font-weight: 600;
            word-break: break-word;
        }

        .review-hint {
            background: rgba(245, 158, 11, 0.1);
            border-left: 3px solid var(--warning);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            color: var(--text-secondary);
        }

        .review-hint strong {
            color: var(--text-primary);
            display: block;
            margin-bottom: 0.5rem;
        }

        .review-explanation {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid var(--module4);
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .review-explanation strong {
            color: var(--text-primary);
            display: block;
            margin-bottom: 0.5rem;
        }

        .results-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 3rem;
            flex-wrap: wrap;
        }

        .results-actions .btn {
            min-width: 200px;
        }

        /* Modal / Dialog */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--dark-surface);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .modal-text {
            color: var(--text-secondary);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
        }

        .modal-actions .btn {
            flex: 1;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .setup-header h1 {
                font-size: 1.875rem;
            }

            .checkbox-group {
                grid-template-columns: 1fr;
            }

            .exam-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .exam-content {
                grid-template-columns: 1fr;
            }

            .question-navigator {
                order: -1;
                position: relative;
                top: auto;
            }

            .navigator-grid {
                grid-template-columns: repeat(10, 1fr);
            }

            .score-circle {
                width: 150px;
                height: 150px;
                font-size: 2.5rem;
            }

            .results-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Accessibility */
        input:focus,
        button:focus,
        a:focus {
            outline: 2px solid var(--primary-light);
            outline-offset: 2px;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body>
    <!-- Setup Screen -->
    <div id="setupScreen" class="screen active">
        <div class="container">
            <div class="setup-screen">
                <div class="setup-header">
                    <h1>PCEP Exam Simulation</h1>
                    <p>Configure your exam settings and start practicing</p>
                </div>

                <!-- Module Selection -->
                <div class="setup-section">
                    <h2><span>üìö</span> Select Modules</h2>
                    <div class="checkbox-group" id="moduleCheckboxes">
                        <div class="checkbox-item">
                            <input type="checkbox" id="module1" value="1" checked>
                            <label for="module1">Module 1: Fundamentals</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="module2" value="2" checked>
                            <label for="module2">Module 2: Control Flow</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="module3" value="3" checked>
                            <label for="module3">Module 3: Functions</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="module4" value="4" checked>
                            <label for="module4">Module 4: Libraries</label>
                        </div>
                    </div>
                    <div class="min-modules-warning" id="minModulesWarning">
                        Please select at least one module
                    </div>
                </div>

                <!-- Question Count -->
                <div class="setup-section">
                    <h2><span>‚ùì</span> Number of Questions</h2>
                    <div class="slider-container">
                        <div class="slider-label">
                            <span>Questions</span>
                            <span class="slider-value" id="questionCountValue">30</span>
                        </div>
                        <input type="range" id="questionCountSlider" min="10" max="100" value="30" step="5">
                    </div>
                </div>

                <!-- Timer Options -->
                <div class="setup-section">
                    <h2><span>‚è±Ô∏è</span> Timer Settings</h2>
                    <div class="timer-checkbox">
                        <input type="checkbox" id="enableTimer" checked>
                        <label for="enableTimer">Enable Timer</label>
                    </div>
                    <div class="timer-info" id="timerInfo">
                        <strong>Estimated time:</strong> <span id="estimatedTime">40</span> minutes
                    </div>
                </div>

                <!-- Answer Mode -->
                <div class="setup-section">
                    <h2><span>üëÅÔ∏è</span> Answer Mode</h2>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" id="modeEnd" name="answerMode" value="end" checked>
                            <div class="radio-item-content">
                                <label for="modeEnd">Show answers at the end</label>
                                <p>See all results after completing the exam</p>
                            </div>
                        </div>
                        <div class="radio-item">
                            <input type="radio" id="modeImmediate" name="answerMode" value="immediate">
                            <div class="radio-item-content">
                                <label for="modeImmediate">Show answers immediately</label>
                                <p>Get instant feedback with hints and explanations</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Start Button -->
                <div class="setup-actions">
                    <button class="btn btn-primary btn-lg" id="startExamBtn" onclick="startExam()">
                        Start Exam ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Exam Screen -->
    <div id="examScreen" class="screen">
        <div class="container">
            <div class="exam-header">
                <div class="exam-progress">
                    <span class="progress-value" id="progressText">Question 1 of 30</span>
                </div>
                <div class="exam-timer" id="examTimer" role="timer">
                    <span id="timerDisplay">40:00</span>
                </div>
                <button class="btn btn-secondary exam-back" id="backToSetupBtn" onclick="confirmBackToSetup()">
                    ‚Üê Back to Setup
                </button>
            </div>

            <div class="exam-content">
                <div class="question-container">
                    <div class="question-number" id="questionNum">Question 1 of 30</div>
                    <div class="question-text" id="questionText">Loading question...</div>

                    <div class="code-block" id="codeBlock" style="display: none;">
                        <code id="codeContent"></code>
                    </div>

                    <div class="options-container" id="optionsContainer">
                        <!-- Options will be dynamically inserted -->
                    </div>

                    <div class="feedback-container" id="feedbackContainer">
                        <!-- Feedback will be dynamically inserted -->
                    </div>

                    <div class="question-controls">
                        <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" disabled>
                            ‚Üê Previous
                        </button>
                        <button class="btn btn-secondary" id="skipBtn" onclick="skipQuestion()">
                            Skip Question
                        </button>
                        <button class="btn btn-secondary" id="nextBtn" onclick="nextQuestion()">
                            Next ‚Üí
                        </button>
                        <button class="btn btn-primary" id="finishBtn" onclick="confirmFinishExam()" style="display: none;">
                            Finish Exam
                        </button>
                    </div>
                </div>

                <div class="question-navigator">
                    <div class="navigator-title">Progress</div>
                    <div class="navigator-grid" id="navigatorGrid">
                        <!-- Navigator items will be dynamically inserted -->
                    </div>
                    <div class="navigator-legend">
                        <div class="legend-item">
                            <div class="legend-dot answered"></div>
                            <span>Answered</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot unanswered"></div>
                            <span>Unanswered</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-dot current"></div>
                            <span>Current</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Results Screen -->
    <div id="resultsScreen" class="screen">
        <div class="container">
            <div class="results-screen">
                <div class="results-header">
                    <h1>Exam Results</h1>
                    <div class="score-circle" id="scoreCircle">
                        <div class="score-percentage" id="scorePercentage">0%</div>
                    </div>
                    <div class="score-status" id="scoreStatus">Loading...</div>
                </div>

                <div class="results-stats">
                    <div class="stat-card">
                        <div class="stat-label">Total Score</div>
                        <div class="stat-value" id="totalScoreDisplay">0/0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Time Taken</div>
                        <div class="stat-value" id="timeTakenDisplay">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Correct Answers</div>
                        <div class="stat-value" id="correctAnswersDisplay">0</div>
                    </div>
                </div>

                <div class="modules-breakdown" id="modulesBreakdown" style="display: none;">
                    <h3>Performance by Module</h3>
                    <div id="moduleScoresContainer"></div>
                </div>

                <div class="detailed-review">
                    <h3>Detailed Review</h3>
                    <div id="detailedReviewContainer"></div>
                </div>

                <div class="results-actions">
                    <button class="btn btn-primary btn-lg" onclick="resetToSetup()">
                        Try Again
                    </button>
                    <button class="btn btn-secondary btn-lg" onclick="location.reload()">
                        Back to Overview
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="backToSetupModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Back to Setup?</div>
            <div class="modal-text">
                Your exam progress will be lost. Are you sure you want to go back to the setup screen?
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('backToSetupModal')">
                    Continue Exam
                </button>
                <button class="btn btn-primary" onclick="backToSetup()">
                    Yes, Go Back
                </button>
            </div>
        </div>
    </div>

    <div id="finishExamModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Finish Exam?</div>
            <div class="modal-text" id="finishExamModalText">
                Are you sure you want to finish the exam? You have not answered all questions.
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeModal('finishExamModal')">
                    Continue Exam
                </button>
                <button class="btn btn-primary" onclick="finishExam()">
                    Yes, Finish
                </button>
            </div>
        </div>
    </div>

    <script>
        // State Management
        const state = {
            questions: [],
            currentQuestionIndex: 0,
            answers: {}, // { questionIndex: selectedOptionIndex }
            skipped: new Set(),
            startTime: null,
            timerInterval: null,
            timeRemaining: 0,
            selectedModules: [1, 2, 3, 4],
            questionCount: 30,
            enableTimer: true,
            answerMode: 'end', // 'end' or 'immediate'
            showFeedback: false,
        };

        // Event Listeners for Setup
        document.getElementById('questionCountSlider').addEventListener('input', (e) => {
            const value = parseInt(e.target.value);
            state.questionCount = value;
            document.getElementById('questionCountValue').textContent = value;
            updateEstimatedTime();
        });

        document.getElementById('enableTimer').addEventListener('change', (e) => {
            state.enableTimer = e.target.checked;
            updateEstimatedTime();
        });

        ['module1', 'module2', 'module3', 'module4'].forEach(id => {
            document.getElementById(id).addEventListener('change', () => {
                updateSelectedModules();
            });
        });

        document.querySelectorAll('input[name="answerMode"]').forEach(radio => {
            radio.addEventListener('change', (e) => {
                state.answerMode = e.target.value;
            });
        });

        // Setup Functions
        function updateEstimatedTime() {
            const minutes = Math.ceil(state.questionCount * 1.33);
            document.getElementById('estimatedTime').textContent = minutes;
            state.timeRemaining = minutes * 60;
        }

        function updateSelectedModules() {
            state.selectedModules = [];
            let count = 0;
            ['module1', 'module2', 'module3', 'module4'].forEach((id, index) => {
                if (document.getElementById(id).checked) {
                    state.selectedModules.push(index + 1);
                    count++;
                }
            });

            const warning = document.getElementById('minModulesWarning');
            if (count === 0) {
                warning.classList.add('show');
                document.getElementById('startExamBtn').disabled = true;
            } else {
                warning.classList.remove('show');
                document.getElementById('startExamBtn').disabled = false;
            }
        }

        async function startExam() {
            // Load questions from JSON file
            try {
                const response = await fetch('./questions-bank-1000.json');
                const data = await response.json();
                
                // Filter questions by selected modules
                let filteredQuestions = data.questions.filter(q => 
                    state.selectedModules.includes(q.module)
                );

                // Shuffle and select
                filteredQuestions = shuffleArray(filteredQuestions).slice(0, state.questionCount);
                state.questions = filteredQuestions;

                // Initialize state
                state.currentQuestionIndex = 0;
                state.answers = {};
                state.skipped = new Set();
                state.showFeedback = false;
                state.startTime = Date.now();

                // Update UI
                showScreen('examScreen');
                buildNavigator();
                displayQuestion();

                // Start timer if enabled
                if (state.enableTimer) {
                    startTimer();
                }

                // Warn on page unload
                window.addEventListener('beforeunload', (e) => {
                    e.preventDefault();
                    e.returnValue = '';
                });
            } catch (error) {
                console.error('Error loading questions:', error);
                alert('Failed to load exam questions. Please check the questions-bank-1000.json file.');
            }
        }

        // Exam Functions
        function displayQuestion() {
            const question = state.questions[state.currentQuestionIndex];
            
            // Update progress
            const total = state.questions.length;
            const current = state.currentQuestionIndex + 1;
            document.getElementById('progressText').textContent = `Question ${current} of ${total}`;
            document.getElementById('questionNum').textContent = `Question ${current} of ${total}`;
            
            // Display question
            document.getElementById('questionText').textContent = question.prompt;

            // Display code if exists
            const codeBlock = document.getElementById('codeBlock');
            if (question.code) {
                document.getElementById('codeContent').textContent = question.code;
                codeBlock.style.display = 'block';
            } else {
                codeBlock.style.display = 'none';
            }

            // Display options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                
                const isSelected = state.answers[state.currentQuestionIndex] === index;
                if (isSelected) optionDiv.classList.add('selected');
                
                // Check if feedback should be shown
                if (state.showFeedback && isSelected) {
                    if (index === question.correct_answer) {
                        optionDiv.classList.add('correct');
                    } else {
                        optionDiv.classList.add('incorrect');
                    }
                }

                const radioId = `option${index}`;
                optionDiv.innerHTML = `
                    <input type="radio" id="${radioId}" name="option" value="${index}" ${isSelected ? 'checked' : ''}>
                    <label class="option-label" for="${radioId}">${String.fromCharCode(65 + index)}. ${option}</label>
                `;

                optionDiv.addEventListener('click', () => selectOption(index));
                optionsContainer.appendChild(optionDiv);
            });

            // Display feedback if in immediate mode and answered
            if (state.answerMode === 'immediate' && state.currentQuestionIndex in state.answers) {
                showFeedback();
            }

            // Clear previous feedback if not immediate mode
            if (state.answerMode === 'end') {
                document.getElementById('feedbackContainer').innerHTML = '';
                document.getElementById('feedbackContainer').classList.remove('show');
            }

            // Update navigation buttons
            document.getElementById('prevBtn').disabled = state.currentQuestionIndex === 0;
            document.getElementById('nextBtn').style.display = current === total ? 'none' : 'inline-flex';
            document.getElementById('finishBtn').style.display = current === total ? 'inline-flex' : 'none';

            // Update navigator
            updateNavigator();

            // Keyboard shortcuts
            document.addEventListener('keydown', handleKeyboard);
        }

        function selectOption(index) {
            state.answers[state.currentQuestionIndex] = index;
            state.skipped.delete(state.currentQuestionIndex);

            if (state.answerMode === 'immediate') {
                showFeedback();
            } else {
                // Just update the display
                document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
                document.querySelectorAll('.option')[index].classList.add('selected');
                updateNavigator();
            }
        }

        function showFeedback() {
            state.showFeedback = true;
            const question = state.questions[state.currentQuestionIndex];
            const selectedOptionIndex = state.answers[state.currentQuestionIndex];
            const isCorrect = selectedOptionIndex === question.correct_answer;

            // Update option styling
            document.querySelectorAll('.option').forEach((opt, index) => {
                opt.classList.remove('correct', 'incorrect');
                if (index === selectedOptionIndex) {
                    if (isCorrect) {
                        opt.classList.add('correct');
                    } else {
                        opt.classList.add('incorrect');
                    }
                }
            });

            // Show feedback
            const feedbackContainer = document.getElementById('feedbackContainer');
            feedbackContainer.innerHTML = `
                <div class="feedback-container ${isCorrect ? 'feedback-correct' : 'feedback-incorrect'} show">
                    <div class="feedback-title">
                        ${isCorrect ? '‚úì Correct!' : '‚úó Incorrect'}
                    </div>
                    ${!isCorrect ? `
                        <div class="hint-section">
                            <strong>Correct Answer:</strong> ${String.fromCharCode(65 + question.correct_answer)}. ${question.options[question.correct_answer]}
                        </div>
                    ` : ''}
                    ${question.hint ? `
                        <div class="hint-section">
                            <strong>Hint:</strong> ${question.hint}
                        </div>
                    ` : ''}
                    ${question.explanation ? `
                        <div class="explanation-section">
                            <strong>Explanation:</strong> ${question.explanation}
                        </div>
                    ` : ''}
                </div>
            `;

            // Update buttons
            document.getElementById('nextBtn').style.display = 'inline-flex';
            document.getElementById('prevBtn').style.display = 'inline-flex';
            document.getElementById('skipBtn').style.display = 'none';
        }

        function nextQuestion() {
            if (state.currentQuestionIndex < state.questions.length - 1) {
                state.currentQuestionIndex++;
                state.showFeedback = false;
                displayQuestion();
            }
        }

        function previousQuestion() {
            if (state.currentQuestionIndex > 0) {
                state.currentQuestionIndex--;
                state.showFeedback = false;
                displayQuestion();
            }
        }

        function skipQuestion() {
            state.skipped.add(state.currentQuestionIndex);
            nextQuestion();
        }

        function buildNavigator() {
            const grid = document.getElementById('navigatorGrid');
            grid.innerHTML = '';

            for (let i = 0; i < state.questions.length; i++) {
                const item = document.createElement('div');
                item.className = 'navigator-item';
                item.textContent = i + 1;

                if (i === state.currentQuestionIndex) {
                    item.classList.add('current');
                } else if (i in state.answers) {
                    item.classList.add('answered');
                } else if (state.skipped.has(i)) {
                    item.classList.add('skipped');
                }

                item.addEventListener('click', () => {
                    state.currentQuestionIndex = i;
                    state.showFeedback = false;
                    displayQuestion();
                });

                grid.appendChild(item);
            }
        }

        function updateNavigator() {
            document.querySelectorAll('.navigator-item').forEach((item, index) => {
                item.classList.remove('current', 'answered', 'skipped');

                if (index === state.currentQuestionIndex) {
                    item.classList.add('current');
                } else if (index in state.answers) {
                    item.classList.add('answered');
                } else if (state.skipped.has(index)) {
                    item.classList.add('skipped');
                }
            });
        }

        function startTimer() {
            const display = document.getElementById('timerDisplay');
            const timer = document.getElementById('examTimer');

            state.timerInterval = setInterval(() => {
                state.timeRemaining--;

                const minutes = Math.floor(state.timeRemaining / 60);
                const seconds = state.timeRemaining % 60;
                display.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

                // Update styling based on time remaining
                const percentage = (state.timeRemaining / (state.questionCount * 1.33 * 60)) * 100;
                timer.classList.remove('warning', 'critical');

                if (percentage <= 10) {
                    timer.classList.add('critical');
                } else if (percentage <= 25) {
                    timer.classList.add('warning');
                }

                if (state.timeRemaining <= 0) {
                    clearInterval(state.timerInterval);
                    finishExam();
                }
            }, 1000);
        }

        function handleKeyboard(e) {
            if (e.key === 'Enter') {
                if (state.currentQuestionIndex < state.questions.length - 1) {
                    nextQuestion();
                } else {
                    confirmFinishExam();
                }
            } else if (e.key === 'Escape') {
                confirmBackToSetup();
            }
        }

        // Results Functions
        function calculateResults() {
            let correct = 0;
            state.questions.forEach((question, index) => {
                if (state.answers[index] === question.correct_answer) {
                    correct++;
                }
            });

            const total = state.questions.length;
            const percentage = Math.round((correct / total) * 100);
            const timeTaken = Math.round((Date.now() - state.startTime) / 1000 / 60);

            // Calculate module breakdown
            const moduleScores = {};
            state.selectedModules.forEach(module => {
                const moduleQuestions = state.questions.filter(q => q.module === module);
                let moduleCorrect = 0;
                moduleQuestions.forEach((question, index) => {
                    const globalIndex = state.questions.indexOf(question);
                    if (state.answers[globalIndex] === question.correct_answer) {
                        moduleCorrect++;
                    }
                });
                moduleScores[module] = {
                    correct: moduleCorrect,
                    total: moduleQuestions.length
                };
            });

            return { correct, total, percentage, timeTaken, moduleScores };
        }

        function finishExam() {
            clearInterval(state.timerInterval);
            window.removeEventListener('beforeunload', () => {});

            const results = calculateResults();

            // Update Results Screen
            const scoreCircle = document.getElementById('scoreCircle');
            scoreCircle.classList.remove('pass', 'fail');
            scoreCircle.classList.add(results.percentage >= 70 ? 'pass' : 'fail');
            
            document.getElementById('scorePercentage').textContent = `${results.percentage}%`;
            document.getElementById('totalScoreDisplay').textContent = `${results.correct}/${results.total}`;
            document.getElementById('correctAnswersDisplay').textContent = results.correct;
            
            const statusEl = document.getElementById('scoreStatus');
            if (results.percentage >= 70) {
                statusEl.textContent = '‚úì PASSED';
                statusEl.classList.add('pass');
                statusEl.classList.remove('fail');
            } else {
                statusEl.textContent = '‚úó FAILED';
                statusEl.classList.add('fail');
                statusEl.classList.remove('pass');
            }

            // Time display
            if (state.enableTimer) {
                document.getElementById('timeTakenDisplay').textContent = `${results.timeTaken} min`;
            } else {
                document.getElementById('timeTakenDisplay').textContent = 'N/A';
            }

            // Module breakdown
            if (state.selectedModules.length > 1) {
                const modulesBreakdown = document.getElementById('modulesBreakdown');
                modulesBreakdown.style.display = 'block';
                const container = document.getElementById('moduleScoresContainer');
                container.innerHTML = '';

                state.selectedModules.forEach(module => {
                    const score = results.moduleScores[module];
                    const percent = Math.round((score.correct / score.total) * 100);
                    const moduleNames = {
                        1: 'Module 1: Fundamentals',
                        2: 'Module 2: Control Flow',
                        3: 'Module 3: Functions',
                        4: 'Module 4: Libraries'
                    };

                    const div = document.createElement('div');
                    div.className = `module-score module${module}`;
                    div.innerHTML = `
                        <div class="module-score-name">${moduleNames[module]}</div>
                        <div class="module-score-bar">
                            <div class="module-score-fill" style="width: ${percent}%"></div>
                        </div>
                        <div class="module-score-value">${score.correct}/${score.total} (${percent}%)</div>
                    `;
                    container.appendChild(div);
                });
            }

            // Detailed review
            const reviewContainer = document.getElementById('detailedReviewContainer');
            reviewContainer.innerHTML = '';

            state.questions.forEach((question, index) => {
                const userAnswer = state.answers[index];
                const isCorrect = userAnswer === question.correct_answer;

                const div = document.createElement('div');
                div.className = `review-item ${isCorrect ? 'correct' : 'incorrect'}`;

                div.innerHTML = `
                    <div class="review-item-header">
                        <div class="review-item-number">Question ${index + 1}</div>
                        <div class="review-item-status ${isCorrect ? 'correct' : 'incorrect'}">
                            ${isCorrect ? '‚úì Correct' : '‚úó Incorrect'}
                        </div>
                    </div>
                    <div class="review-item-question">${question.prompt}</div>
                    ${question.code ? `<div class="review-item-code"><code>${escapeHtml(question.code)}</code></div>` : ''}
                    <div class="review-answers">
                        ${userAnswer !== undefined ? `
                            <div class="answer-result your-answer">
                                <label>Your Answer</label>
                                <div class="answer-result-text">${String.fromCharCode(65 + userAnswer)}. ${question.options[userAnswer]}</div>
                            </div>
                        ` : '<div class="answer-result your-answer"><label>Not Answered</label></div>'}
                        ${!isCorrect ? `
                            <div class="answer-result correct-answer">
                                <label>Correct Answer</label>
                                <div class="answer-result-text">${String.fromCharCode(65 + question.correct_answer)}. ${question.options[question.correct_answer]}</div>
                            </div>
                        ` : ''}
                    </div>
                    ${question.hint ? `<div class="review-hint"><strong>Hint:</strong> ${question.hint}</div>` : ''}
                    ${question.explanation ? `<div class="review-explanation"><strong>Explanation:</strong> ${question.explanation}</div>` : ''}
                `;

                reviewContainer.appendChild(div);
            });

            showScreen('resultsScreen');
        }

        function resetToSetup() {
            state.currentQuestionIndex = 0;
            state.answers = {};
            state.skipped = new Set();
            state.showFeedback = false;
            showScreen('setupScreen');
        }

        // Modal Functions
        function confirmBackToSetup() {
            document.getElementById('backToSetupModal').classList.add('active');
        }

        function backToSetup() {
            closeModal('backToSetupModal');
            resetToSetup();
        }

        function confirmFinishExam() {
            const allAnswered = Object.keys(state.answers).length === state.questions.length;
            const modalText = document.getElementById('finishExamModalText');
            
            if (!allAnswered) {
                const unanswered = state.questions.length - Object.keys(state.answers).length;
                modalText.textContent = `You have ${unanswered} unanswered question(s). Are you sure you want to finish?`;
            } else {
                modalText.textContent = 'Are you sure you want to finish the exam?';
            }

            document.getElementById('finishExamModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Utility Functions
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        function shuffleArray(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Initialize
        updateSelectedModules();
        updateEstimatedTime();
    </script>
</body>
</html>
